/*===========================================================================*
 * File:        main.c
 * Project:     ECU
 * Author:      Mateusz MrÃ³z
 * Date:        06.09.2021
 * Brief:       Main.c
 *===========================================================================*/

/*===========================================================================*
 *
 * INCLUDE SECTION
 *
 *===========================================================================*/

#include "main.h"

#include "rcc.h"

/*===========================================================================*
 *
 * DEFINES AND MACRO SECTION
 *
 *===========================================================================*/

#define LEDPORT                 (GPIOC)
#define LED1                    (13u)
#define ENABLE_GPIO_CLOCK       (RCC->AHB1ENR |= RCC_AHB1ENR_GPIOCEN)

/*===========================================================================*
 *
 * LOCAL TYPES AND ENUMERATION SECTION
 *
 *===========================================================================*/

/*===========================================================================*
 *
 * GLOBAL VARIABLES AND CONSTANTS SECTION
 *
 *===========================================================================*/

/*===========================================================================*
 *
 * LOCAL FUNCTION DECLARATION SECTION
 *
 *===========================================================================*/

/*===========================================================================*
 * brief:       Function stopping MCU for given time
 * param[in]:   ms - time in ms
 * param[out]:  None
 * return:      None
 * details:     None
 *===========================================================================*/
static void Main_MsDelay(uint32_t ms);

/*===========================================================================*
 *
 * FUNCTION DEFINITION SECTION
 *
 *===========================================================================*/

/*===========================================================================*
 * Function: main
 *===========================================================================*/
int main(void)
{
    SystemCoreClockUpdate();

    ENABLE_GPIO_CLOCK;
    GPIOC->MODER |= GPIO_MODER_MODER13_0;

    while(1)
    {
        Main_MsDelay(10000u);
        LEDPORT->ODR ^= (1<<LED1);
    }
}

/*===========================================================================*
 *
 * LOCAL FUNCTION DEFINITION SECTION
 *
 *===========================================================================*/

/*===========================================================================*
 * Function: Main_MsDelay
 *===========================================================================*/
static void Main_MsDelay(uint32_t ms)
{
    volatile uint32_t x;

    while (ms-- > 0)
    {
        x = 500;

        while (x-- > 0)
        {
            __asm("nop");
        }
    }
}


/* end of file */
